diff -urN m17n-lib-1.5.5/src/input.c m17n-lib-1.5.5.new/src/input.c
--- m17n-lib-1.5.5/src/input.c	2009-02-25 08:12:22.000000000 +0530
+++ m17n-lib-1.5.5.new/src/input.c	2010-11-12 10:48:27.000000000 +0530
@@ -270,8 +270,8 @@
 static int update_custom_info (void);
 static MInputMethodInfo *get_im_info (MSymbol, MSymbol, MSymbol, MSymbol);
 
-
-void
+
+static void
 fully_initialize ()
 {
   char *key_names[32]
diff -urN m17n-lib-1.5.5/src/input-gui.c m17n-lib-1.5.5.new/src/input-gui.c
--- m17n-lib-1.5.5/src/input-gui.c	2007-03-29 16:59:30.000000000 +0530
+++ m17n-lib-1.5.5.new/src/input-gui.c	2010-11-12 10:52:18.000000000 +0530
@@ -684,8 +684,8 @@
     cleared.
 
     If $EVENT still has modifiers, the name is preceded by "S-"
-    (Shift), "C-" (Control), "M-" (Meta), "A-" (Alt), "s-" (Super),
-    and/or "H-" (Hyper) in this order.
+    (Shift), "C-" (Control), "M-" (Meta), "A-" (Alt), "G-" (AltGr),
+    "s-" (Super), and "H-" (Hyper) in this order.
 
     For instance, if the keysym name is "a" and the event has Shift,
     Meta, and Hyper modifiers, the resulting name is "M-H-A".
@@ -712,8 +712,8 @@
     0x1F とをビット単位で and 演算し、Control モディファイアは取り除かれる。
 
     それでも $EVENT にまだモディファイアがあれば、名前の前にそれぞれ
-    "S-" (Shift), "C-" (Control), "M-" (Meta), "A-" (Alt), "s-"
-    (Super), "H-" (Hyper)がこの順番で付く。
+    "S-" (Shift), "C-" (Control), "M-" (Meta), "A-" (Alt), , "G-" (AltGr),
+    "s-" (Super), "H-" (Hyper)がこの順番で付く。
     
     たとえば、keysym 名が "a" でイベントが Shift, Meta, and Hyper 
     モディファイアを持てば、得られる名前は "M-H-A" である。
@@ -734,7 +734,7 @@
     return key;
 
   name = msymbol_name (key);
-  str = alloca (strlen (name) + 2 * 6 + 1);
+  str = alloca (strlen (name) + 2 * 8 + 1);
   str[0] = '\0';
   if (modifiers & MINPUT_KEY_SHIFT_MODIFIER)
     strcat (str, "S-");
@@ -744,6 +744,8 @@
     strcat (str, "M-");
   if (modifiers & MINPUT_KEY_ALT_MODIFIER)
     strcat (str, "A-");
+  if (modifiers & MINPUT_KEY_ALTGR_MODIFIER)
+    strcat (str, "G-");
   if (modifiers & MINPUT_KEY_SUPER_MODIFIER)
     strcat (str, "s-");
   if (modifiers & MINPUT_KEY_HYPER_MODIFIER)
diff -urN m17n-lib-1.5.5/src/input.h m17n-lib-1.5.5.new/src/input.h
--- m17n-lib-1.5.5/src/input.h	2006-12-26 17:14:32.000000000 +0530
+++ m17n-lib-1.5.5.new/src/input.h	2010-11-12 10:48:46.000000000 +0530
@@ -98,6 +98,7 @@
 #define MINPUT_KEY_ALT_MODIFIER		(1 << 3)
 #define MINPUT_KEY_SUPER_MODIFIER	(1 << 4)
 #define MINPUT_KEY_HYPER_MODIFIER	(1 << 5)
+#define MINPUT_KEY_ALTGR_MODIFIER	(1 << 6)
 
 extern MSymbol minput__char_to_key (int c);
 
diff -urN m17n-lib-1.5.5/src/m17n-X.c m17n-lib-1.5.5.new/src/m17n-X.c
--- m17n-lib-1.5.5/src/m17n-X.c	2008-01-06 19:53:33.000000000 +0530
+++ m17n-lib-1.5.5.new/src/m17n-X.c	2010-11-12 10:55:01.000000000 +0530
@@ -84,6 +84,7 @@
   int alt_mask;
   int super_mask;
   int hyper_mask;
+  int altgr_mask;
 
   Atom MULE_BASELINE_OFFSET;
   Atom AVERAGE_WIDTH;
@@ -258,6 +259,10 @@
   KeyCode super_r = XKeysymToKeycode (display, XK_Super_R);
   KeyCode hyper_l = XKeysymToKeycode (display, XK_Hyper_L);
   KeyCode hyper_r = XKeysymToKeycode (display, XK_Hyper_R);
+#ifdef XK_XKB_KEYS
+  KeyCode altgr = XKeysymToKeycode (display, XK_ISO_Level3_Shift);
+#endif
+
   int i, j;
 
   mods = XGetModifierMapping (display);
@@ -278,6 +283,10 @@
 	  disp_info->super_mask |= (1 << i);
 	else if (code == hyper_l || code == hyper_r)
 	  disp_info->hyper_mask |= (1 << i);
+#ifdef XK_XKB_KEYS
+	else if (code == altgr)
+	  disp_info->altgr_mask |= (1 << i);
+#endif
       }
 
   /* If meta keys are not in any modifier, use alt keys as meta
@@ -1983,6 +1992,10 @@
     return Mnil;
   if (keysym >= XK_Shift_L && keysym <= XK_Hyper_R)
     return Mnil;
+#ifdef XK_XKB_KEYS
+  if ((keysym & 0xff00) == 0xfe00)
+    return Mnil;
+#endif
   if (len == 1 && keysym >= XK_space && keysym <= XK_asciitilde)
     {
       int c = keysym;
@@ -2011,7 +2024,10 @@
     *modifiers |= MINPUT_KEY_SUPER_MODIFIER;
   if (((XKeyEvent *) event)->state & disp_info->hyper_mask)
     *modifiers |= MINPUT_KEY_HYPER_MODIFIER;
-
+#ifdef XK_XKB_KEYS
+  if (((XKeyEvent *) event)->state & disp_info->altgr_mask)
+    *modifiers |= MINPUT_KEY_ALTGR_MODIFIER;
+#endif
   return key;
 }
 
